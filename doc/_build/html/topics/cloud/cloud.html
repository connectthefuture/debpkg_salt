<!DOCTYPE html>








<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Writing Cloud Provider Modules</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="google-site-verification" content="1Y-ojT3ndjxA9coB77iUDyXPWxeuQ3T4_r0j-QG6QHg" />

        
    
    <link rel="stylesheet" href="../../_static/css/main.css">
    
    <link rel="stylesheet" href="../../_static/basic.css">
    <link rel="stylesheet" href="../../_static/pygments.css">

    <link rel="stylesheet" href="../../_static/css/bootstrap.css">
    <style>
        body { padding-top: 20px; }
    </style>
    <link rel="stylesheet" href="../../_static/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="../../_static/css/main.css">
        
    <script>
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '2014.1.4',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };
    </script>
    
    <script src="../../_static/js/vendor/jquery-1.9.1.js"></script>
    
    
    <script src="../../_static/js/vendor/bootstrap.min.js"></script>
    
    
    
    <script src="../../_static/underscore.js"></script>
    
    
    <script src="../../_static/doctools.js"></script>
    
        <link rel="shortcut icon" href="../../_static/favicon.ico">
        <link rel="top" title="None" href="../../index.html">
        <link rel="up" title="Salt Cloud Documentation" href="index.html">
        <link rel="next" title="Core Configuration" href="config.html">
        <link rel="prev" title="Getting Started With Azure" href="azure.html"> 
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,800italic,300,800' rel='stylesheet' type='text/css'>
        <script src="../../_static/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        
    </head>

    <body class="index">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="../../index.html"><img src="../../_static/images/SaltStack-Logo.png" /></a>
                    <div class="nav-collapse collapse">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="azure.html" title="Getting Started With Azure">previous</a>
                
            </li>
            <li>
                <a href="config.html" title="Core Configuration">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div>
                    </div>
                </div>
            </div>
        </div>
        

        <div class="content row-fluid">
            <div class="container">
                <div class="span12">
                    <div class="span9">
                        
  <div class="section" id="writing-cloud-provider-modules">
<h1>Writing Cloud Provider Modules<a class="headerlink" href="#writing-cloud-provider-modules" title="Permalink to this headline">¶</a></h1>
<p>Salt Cloud runs on a module system similar to the main Salt project. The
modules inside saltcloud exist in the <tt class="docutils literal"><span class="pre">salt/cloud/clouds</span></tt> directory of the
salt source.</p>
<p>There are two basic types of cloud modules. If a cloud provider is supported by
libcloud, then using it is the fastest route to getting a module written. The
Apache Libcloud project is located at:</p>
<p><a class="reference external" href="http://libcloud.apache.org/">http://libcloud.apache.org/</a></p>
<p>Not every cloud provider is supported by libcloud. Additionally, not every
feature in a supported cloud provider is necessary supported by libcloud. In
either of these cases, a module can be created which does not rely on libcloud.</p>
<div class="section" id="all-modules">
<h2>All Modules<a class="headerlink" href="#all-modules" title="Permalink to this headline">¶</a></h2>
<p>The following functions are required by all modules, whether or not they are
based on libcloud.</p>
<div class="section" id="the-virtual-function">
<h3>The __virtual__() Function<a class="headerlink" href="#the-virtual-function" title="Permalink to this headline">¶</a></h3>
<p>This function determines whether or not to make this cloud module available
upon execution. Most often, it uses <tt class="docutils literal"><span class="pre">get_configured_provider()</span></tt> to determine
if the necessary configuration has been set up. It may also check for necessary
imports, to decide whether to load the module. In most cases, it will return a
<tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt> value. If the name of the driver used does not match the
filename, then that name should be returned instead of <tt class="docutils literal"><span class="pre">True</span></tt>. An example of
this may be seen in the Azure module:</p>
<p><a class="reference external" href="https://github.com/saltstack/salt/blob/develop/salt/cloud/clouds/msazure.py">https://github.com/saltstack/salt/blob/develop/salt/cloud/clouds/msazure.py</a></p>
</div>
<div class="section" id="the-get-configured-provider-function">
<h3>The get_configured_provider() Function<a class="headerlink" href="#the-get-configured-provider-function" title="Permalink to this headline">¶</a></h3>
<p>This function uses <tt class="docutils literal"><span class="pre">config.is_provider_configured()</span></tt> to determine wither
all required information for this driver has been configured. The last value
in the list of required settings should be followed by a comma.</p>
</div>
</div>
<div class="section" id="libcloud-based-modules">
<h2>Libcloud Based Modules<a class="headerlink" href="#libcloud-based-modules" title="Permalink to this headline">¶</a></h2>
<p>Writing a cloud module based on libcloud has two major advantages. First of all,
much of the work has already been done by the libcloud project. Second, most of
the functions necessary to Salt have already been added to the Salt Cloud
project.</p>
<div class="section" id="the-create-function">
<h3>The create() Function<a class="headerlink" href="#the-create-function" title="Permalink to this headline">¶</a></h3>
<p>The most important function that does need to be manually written is the
<tt class="docutils literal"><span class="pre">create()</span></tt> function. This is what is used to request a virtual machine to be
created by the cloud provider, wait for it to become available, and then
(optionally) log in and install Salt on it.</p>
<p>A good example to follow for writing a cloud provider module based on libcloud
is the module provided for Linode:</p>
<p><a class="reference external" href="https://github.com/saltstack/salt/blob/develop/salt/cloud/clouds/linode.py">https://github.com/saltstack/salt/blob/develop/salt/cloud/clouds/linode.py</a></p>
<p>The basic flow of a <tt class="docutils literal"><span class="pre">create()</span></tt> function is as follows:</p>
<ul class="simple">
<li>Send a request to the cloud provider to create a virtual machine.</li>
<li>Wait for the virtual machine to become available.</li>
<li>Generate kwargs to be used to deploy Salt.</li>
<li>Log into the virtual machine and deploy Salt.</li>
<li>Return a data structure that describes the newly-created virtual machine.</li>
</ul>
<p>At various points throughout this function, events may be fired on the Salt
event bus. Four of these events, which are described below, are required. Other
events may be added by the user, where appropriate.</p>
<p>When the <tt class="docutils literal"><span class="pre">create()</span></tt> function is called, it is passed a data structure called
<tt class="docutils literal"><span class="pre">vm_</span></tt>. This dict contains a composite of information describing the virtual
machine to be created. A dict called <tt class="docutils literal"><span class="pre">__opts__</span></tt> is also provided by Salt,
which contains the options used to run Salt Cloud, as well as a set of
configuration and environment variables.</p>
<p>The first thing the <tt class="docutils literal"><span class="pre">create()</span></tt> function must do is fire an event stating that
it has started the create process. This event is tagged
<tt class="docutils literal"><span class="pre">salt/cloud/&lt;vm</span> <span class="pre">name&gt;/creating</span></tt>. The payload contains the names of the VM,
profile and provider.</p>
<p>A set of kwargs is then usually created, to describe the parameters required
by the cloud provider to request the virtual machine.</p>
<p>An event is then fired to state that a virtual machine is about to be requested.
It is tagged as <tt class="docutils literal"><span class="pre">salt/cloud/&lt;vm</span> <span class="pre">name&gt;/requesting</span></tt>. The payload contains most
or all of the parameters that will be sent to the cloud provider. Any private
information (such as passwords) should not be sent in the event.</p>
<p>After a request is made, a set of deploy kwargs will be generated. These will
be used to install Salt on the target machine. Windows options are supported
at this point, and should be generated, even if the cloud provider does not
currently support Windows. This will save time in the future if the provider
does eventually decide to support Windows.</p>
<p>An event is then fired to state that the deploy process is about to begin. This
event is tagged <tt class="docutils literal"><span class="pre">salt/cloud/&lt;vm</span> <span class="pre">name&gt;/deploying</span></tt>. The payload for the event
will contain a set of deploy kwargs, useful for debugging purposed. Any private
data, including passwords and keys (including public keys) should be stripped
from the deploy kwargs before the event is fired.</p>
<p>If any Windows options have been passed in, the
<tt class="docutils literal"><span class="pre">salt.utils.cloud.deploy_windows()</span></tt> function will be called. Otherwise, it
will be assumed that the target is a Linux or Unix machine, and the
<tt class="docutils literal"><span class="pre">salt.utils.cloud.deploy_script()</span></tt> will be called.</p>
<p>Both of these functions will wait for the target machine to become available,
then the necessary port to log in, then a successful login that can be used to
install Salt. Minion configuration and keys will then be uploaded to a temporary
directory on the target by the appropriate function. On a Windows target, the
Windows Minion Installer will be run in silent mode. On a Linux/Unix target, a
deploy script (bootstrap-salt.sh, by default) will be run, which will
auto-detect the operating system, and install Salt using its native package
manager. These do not need to be handled by the developer in the cloud module.</p>
<p>After the appropriate deploy function completes, a final event is fired
which describes the virtual machine that has just been created. This event is
tagged <tt class="docutils literal"><span class="pre">salt/cloud/&lt;vm</span> <span class="pre">name&gt;/created</span></tt>. The payload contains the names of the
VM, profile and provider.</p>
<p>Finally, a dict (queried from the provider) which describes the new virtual
machine is returned to the user. Because this data is not fired on the event
bus it can, and should, return any passwords that were returned by the cloud
provider. In some cases (for example, Rackspace), this is the only time that
the password can be queried by the user; post-creation queries may not contain
password information (depending upon the provider).</p>
</div>
<div class="section" id="the-libcloudfuncs-functions">
<h3>The libcloudfuncs Functions<a class="headerlink" href="#the-libcloudfuncs-functions" title="Permalink to this headline">¶</a></h3>
<p>A number of other functions are required for all cloud providers. However, with
libcloud-based modules, these are all provided for free by the libcloudfuncs
library. The following two lines set up the imports:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">salt.cloud.libcloudfuncs</span> <span class="kn">import</span> <span class="o">*</span>   <span class="c"># pylint: disable=W0614,W0401</span>
<span class="kn">from</span> <span class="nn">salt.utils</span> <span class="kn">import</span> <span class="n">namespaced_function</span>
</pre></div>
</div>
<p>And then a series of declarations will make the necessary functions available
within the cloud module.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">get_size</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">get_size</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">get_image</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">get_image</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">avail_locations</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">avail_locations</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">avail_images</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">avail_images</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">avail_sizes</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">avail_sizes</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">destroy</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">destroy</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">list_nodes</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">list_nodes_full</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">list_nodes_full</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">list_nodes_select</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">list_nodes_select</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
<span class="n">show_instance</span> <span class="o">=</span> <span class="n">namespaced_function</span><span class="p">(</span><span class="n">show_instance</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
<p>If necessary, these functions may be replaced by removing the appropriate
declaration line, and then adding the function as normal.</p>
<p>These functions are required for all cloud modules, and are described in detail
in the next section.</p>
</div>
</div>
<div class="section" id="non-libcloud-based-modules">
<h2>Non-Libcloud Based Modules<a class="headerlink" href="#non-libcloud-based-modules" title="Permalink to this headline">¶</a></h2>
<p>In some cases, using libcloud is not an option. This may be because libcloud has
not yet included the necessary driver itself, or it may be that the driver that
is included with libcloud does not contain all of the necessary features
required by the developer. When this is the case, some or all of the functions
in <tt class="docutils literal"><span class="pre">libcloudfuncs</span></tt> may be replaced. If they are all replaced, the libcloud
imports should be absent from the Salt Cloud module.</p>
<p>A good example of a non-libcloud provider is the Digital Ocean module:</p>
<p><a class="reference external" href="https://github.com/saltstack/salt/blob/develop/salt/cloud/clouds/digital_ocean.py">https://github.com/saltstack/salt/blob/develop/salt/cloud/clouds/digital_ocean.py</a></p>
<div class="section" id="id1">
<h3>The <tt class="docutils literal"><span class="pre">create()</span></tt> Function<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">create()</span></tt> function must be created as described in the libcloud-based
module documentation.</p>
</div>
<div class="section" id="the-get-size-function">
<h3>The get_size() Function<a class="headerlink" href="#the-get-size-function" title="Permalink to this headline">¶</a></h3>
<p>This function is only necessary for libcloud-based modules, and does not need
to exist otherwise.</p>
</div>
<div class="section" id="the-get-image-function">
<h3>The get_image() Function<a class="headerlink" href="#the-get-image-function" title="Permalink to this headline">¶</a></h3>
<p>This function is only necessary for libcloud-based modules, and does not need
to exist otherwise.</p>
</div>
<div class="section" id="the-avail-locations-function">
<h3>The avail_locations() Function<a class="headerlink" href="#the-avail-locations-function" title="Permalink to this headline">¶</a></h3>
<p>This function returns a list of locations available, if the cloud provider uses
multiple data centers. It is not necessary if the cloud provider only uses one
data center. It is normally called using the <tt class="docutils literal"><span class="pre">--list-locations</span></tt> option.</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud --list-locations my-cloud-provider
</pre></div>
</div>
</div>
<div class="section" id="the-avail-images-function">
<h3>The avail_images() Function<a class="headerlink" href="#the-avail-images-function" title="Permalink to this headline">¶</a></h3>
<p>This function returns a list of images available for this cloud provider. There
are not currently any known cloud providers that do not provide this
functionality, though they may refer to images by a different name (for example,
&quot;templates&quot;). It is normally called using the <tt class="docutils literal"><span class="pre">--list-images</span></tt> option.</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud --list-images my-cloud-provider
</pre></div>
</div>
</div>
<div class="section" id="the-avail-sizes-function">
<h3>The avail_sizes() Function<a class="headerlink" href="#the-avail-sizes-function" title="Permalink to this headline">¶</a></h3>
<p>This function returns a list of sizes available for this cloud provider.
Generally, this refers to a combination of RAM, CPU and/or disk space. This
functionality may not be present on some cloud providers. For example, the
Parallels module breaks down RAM, CPU and disk space into separate options,
whereas in other providers, these options are baked into the image. It is
normally called using the <tt class="docutils literal"><span class="pre">--list-sizes</span></tt> option.</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud --list-sizes my-cloud-provider
</pre></div>
</div>
</div>
<div class="section" id="the-script-function">
<h3>The script() Function<a class="headerlink" href="#the-script-function" title="Permalink to this headline">¶</a></h3>
<p>This function builds the deploy script to be used on the remote machine.  It is
likely to be moved into the <tt class="docutils literal"><span class="pre">salt.utils.cloud</span></tt> library in the near future, as
it is very generic and can usually be copied wholesale from another module. An
excellent example is in the Azure driver.</p>
</div>
<div class="section" id="the-destroy-function">
<h3>The destroy() Function<a class="headerlink" href="#the-destroy-function" title="Permalink to this headline">¶</a></h3>
<p>This function irreversably destroys a virtual machine on the cloud provider.
Before doing so, it should fire an event on the Salt event bus. The tag for this
event is <tt class="docutils literal"><span class="pre">salt/cloud/&lt;vm</span> <span class="pre">name&gt;/destroying</span></tt>. Once the virtual machine has been
destroyed, another event is fired. The tag for that event is
<tt class="docutils literal"><span class="pre">salt/cloud/&lt;vm</span> <span class="pre">name&gt;/destroyed</span></tt>.</p>
<p>This function is normally called with the <tt class="docutils literal"><span class="pre">-d</span></tt> options:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -d myinstance
</pre></div>
</div>
</div>
<div class="section" id="the-list-nodes-function">
<h3>The list_nodes() Function<a class="headerlink" href="#the-list-nodes-function" title="Permalink to this headline">¶</a></h3>
<p>This function returns a list of nodes available on this cloud provider, using
the following fields:</p>
<ul class="simple">
<li>id (str)</li>
<li>image (str)</li>
<li>size (str)</li>
<li>state (str)</li>
<li>private_ips (list)</li>
<li>public_ips (list)</li>
</ul>
<p>No other fields should be returned in this function, and all of these fields
should be returned, even if empty. The private_ips and public_ips fields should
always be of a list type, even if empty, and the other fields should always be
of a str type. This function is normally called with the <tt class="docutils literal"><span class="pre">-Q</span></tt> option:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -Q
</pre></div>
</div>
</div>
<div class="section" id="the-list-nodes-full-function">
<h3>The list_nodes_full() Function<a class="headerlink" href="#the-list-nodes-full-function" title="Permalink to this headline">¶</a></h3>
<p>All information available about all nodes should be returned in this function.
The fields in the list_nodes() function should also be returned, even if they
would not normally be provided by the cloud provider. This is because some
functions both within Salt and 3rd party will break if an expected field is not
present. This function is normally called with the <tt class="docutils literal"><span class="pre">-F</span></tt> option:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -F
</pre></div>
</div>
</div>
<div class="section" id="the-list-nodes-select-function">
<h3>The list_nodes_select() Function<a class="headerlink" href="#the-list-nodes-select-function" title="Permalink to this headline">¶</a></h3>
<p>This function returns only the fields specified in the <tt class="docutils literal"><span class="pre">query.selection</span></tt>
option in <tt class="docutils literal"><span class="pre">/etc/salt/cloud</span></tt>. Because this function is so generic, all of the
heavy lifting has been moved into the <tt class="docutils literal"><span class="pre">salt.utils.cloud</span></tt> library.</p>
<p>A function to call <tt class="docutils literal"><span class="pre">list_nodes_select()</span></tt> still needs to be present. In
general, the following code can be used as-is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">list_nodes_select</span><span class="p">(</span><span class="n">call</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return a list of the VMs that are on the provider, with select fields</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">salt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">list_nodes_select</span><span class="p">(</span>
        <span class="n">list_nodes_full</span><span class="p">(</span><span class="s">&#39;function&#39;</span><span class="p">),</span> <span class="n">__opts__</span><span class="p">[</span><span class="s">&#39;query.selection&#39;</span><span class="p">],</span> <span class="n">call</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>However, depending on the cloud provider, additional variables may be required.
For instance, some modules use a <tt class="docutils literal"><span class="pre">conn</span></tt> object, or may need to pass other
options into <tt class="docutils literal"><span class="pre">list_nodes_full()</span></tt>. In this case, be sure to update the function
appropriately:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">list_nodes_select</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return a list of the VMs that are on the provider, with select fields</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">get_conn</span><span class="p">()</span>   <span class="c"># pylint: disable=E0602</span>

    <span class="k">return</span> <span class="n">salt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">list_nodes_select</span><span class="p">(</span>
        <span class="n">list_nodes_full</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">&#39;function&#39;</span><span class="p">),</span>
        <span class="n">__opts__</span><span class="p">[</span><span class="s">&#39;query.selection&#39;</span><span class="p">],</span>
        <span class="n">call</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This function is normally called with the <tt class="docutils literal"><span class="pre">-S</span></tt> option:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -S
</pre></div>
</div>
</div>
<div class="section" id="the-show-instance-function">
<h3>The show_instance() Function<a class="headerlink" href="#the-show-instance-function" title="Permalink to this headline">¶</a></h3>
<p>This function is used to display all of the information about a single node
that is available from the cloud provider. The simplest way to provide this is
usually to call <tt class="docutils literal"><span class="pre">list_nodes_full()</span></tt>, and return just the data for the
requested node. It is normally called as an action:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -a show_instance myinstance
</pre></div>
</div>
</div>
</div>
<div class="section" id="actions-and-functions">
<h2>Actions and Functions<a class="headerlink" href="#actions-and-functions" title="Permalink to this headline">¶</a></h2>
<p>Extra functionality may be added to a cloud provider in the form of an
<tt class="docutils literal"><span class="pre">--action</span></tt> or a <tt class="docutils literal"><span class="pre">--function</span></tt>. Actions are performed against a cloud
instance/virtual machine, and functions are performed against a cloud provider.</p>
<div class="section" id="actions">
<h3>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h3>
<p>Actions are calls that are performed against a specific instance or virtual
machine. The <tt class="docutils literal"><span class="pre">show_instance</span></tt> action should be available in all cloud modules.
Actions are normally called with the <tt class="docutils literal"><span class="pre">-a</span></tt> option:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -a show_instance myinstance
</pre></div>
</div>
<p>Actions must accept a <tt class="docutils literal"><span class="pre">name</span></tt> as a first argument, may optionally support any
number of kwargs as appropriate, and must accept an argument of <tt class="docutils literal"><span class="pre">call</span></tt>, with
a default of <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>Before performing any other work, an action should normally verify that it has
been called correctly. It may then perform the desired feature, and return
useful information to the user. A basic action looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">show_instance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Show the details from EC2 concerning an AMI</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">if</span> <span class="n">call</span> <span class="o">!=</span> <span class="s">&#39;action&#39;</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">SaltCloudSystemExit</span><span class="p">(</span>
        <span class="s">&#39;The show_instance action must be called with -a or --action.&#39;</span>
    <span class="p">)</span>

<span class="k">return</span> <span class="n">_get_node</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Please note that generic kwargs, if used, are passed through to actions as
<tt class="docutils literal"><span class="pre">kwargs</span></tt> and not <tt class="docutils literal"><span class="pre">**kwargs</span></tt>. An example of this is seen in the Functions
section.</p>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>Functions are called that are performed against a specific cloud provider. An
optional function that is often useful is <tt class="docutils literal"><span class="pre">show_image</span></tt>, which describes an
image in detail. Functions are normally called with the <tt class="docutils literal"><span class="pre">-f</span></tt> option:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -f show_image my-cloud-provider <span class="nv">image</span><span class="o">=</span><span class="s1">&#39;Ubuntu 13.10 64-bit&#39;</span>
</pre></div>
</div>
<p>A function may accept any number of kwargs as appropriate, and must accept an
argument of <tt class="docutils literal"><span class="pre">call</span></tt> with a default of <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>Before performing any other work, a function should normally verify that it has
been called correctly. It may then perform the desired feature, and return
useful information to the user. A basic function looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">show_image</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">call</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Show the details from EC2 concerning an AMI</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">call</span> <span class="o">!=</span> <span class="s">&#39;function&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SaltCloudSystemExit</span><span class="p">(</span>
            <span class="s">&#39;The show_image action must be called with -f or --function.&#39;</span>
        <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ImageId.1&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">],</span>
              <span class="s">&#39;Action&#39;</span><span class="p">:</span> <span class="s">&#39;DescribeImages&#39;</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Take note that generic kwargs are passed through to functions as <tt class="docutils literal"><span class="pre">kwargs</span></tt> and
not <tt class="docutils literal"><span class="pre">**kwargs</span></tt>.</p>
</div>
</div>
</div>


                    </div>
    <div class="span3">
    <div>

        <p>Current Salt release: <a href="../releases/2014.1.4.html">2014.1.4</a></p>

        <p class="muted">Docs for previous releases on
            <a href="http://salt.readthedocs.org">salt.rtfd.org</a>.</p>
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Writing Cloud Provider Modules</a><ul>
<li><a class="reference internal" href="#all-modules">All Modules</a><ul>
<li><a class="reference internal" href="#the-virtual-function">The __virtual__() Function</a></li>
<li><a class="reference internal" href="#the-get-configured-provider-function">The get_configured_provider() Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#libcloud-based-modules">Libcloud Based Modules</a><ul>
<li><a class="reference internal" href="#the-create-function">The create() Function</a></li>
<li><a class="reference internal" href="#the-libcloudfuncs-functions">The libcloudfuncs Functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#non-libcloud-based-modules">Non-Libcloud Based Modules</a><ul>
<li><a class="reference internal" href="#id1">The <tt class="docutils literal"><span class="pre">create()</span></tt> Function</a></li>
<li><a class="reference internal" href="#the-get-size-function">The get_size() Function</a></li>
<li><a class="reference internal" href="#the-get-image-function">The get_image() Function</a></li>
<li><a class="reference internal" href="#the-avail-locations-function">The avail_locations() Function</a></li>
<li><a class="reference internal" href="#the-avail-images-function">The avail_images() Function</a></li>
<li><a class="reference internal" href="#the-avail-sizes-function">The avail_sizes() Function</a></li>
<li><a class="reference internal" href="#the-script-function">The script() Function</a></li>
<li><a class="reference internal" href="#the-destroy-function">The destroy() Function</a></li>
<li><a class="reference internal" href="#the-list-nodes-function">The list_nodes() Function</a></li>
<li><a class="reference internal" href="#the-list-nodes-full-function">The list_nodes_full() Function</a></li>
<li><a class="reference internal" href="#the-list-nodes-select-function">The list_nodes_select() Function</a></li>
<li><a class="reference internal" href="#the-show-instance-function">The show_instance() Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actions-and-functions">Actions and Functions</a><ul>
<li><a class="reference internal" href="#actions">Actions</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="azure.html"
                        title="previous chapter">Getting Started With Azure</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="config.html"
                        title="next chapter">Core Configuration</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

        <h3>Upcoming SaltStack Events</h3>
        <script src="http://cdn.lanyrd.net/badges/person-v1.min.js"></script>
        <div class="lanyrd-target-splat"><a href="http://lanyrd.com/profile/saltstackinc/" class="lanyrd-splat lanyrd-number-3 lanyrd-context-future" rel="me">My conferences on Lanyrd</a></div>
    </div>
    </div>
                </div>
            </div>
        </div>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="azure.html" title="Getting Started With Azure">previous</a>
                
            </li>
            <li>
                <a href="config.html" title="Core Configuration">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div></div>
            </div>
        
            <footer>
                <div class="container">
                        <div class="row-fluid">
                                <div class="footerCol">
                                        <h4>About Us</h4>
                                        <a href="http://saltstack.com/">SaltStack</a>
                                        <a href="http://saltstack.com/about/">Leadership</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Products</h4>
                                        <a href="http://saltstack.com/enterprise/">Enterprise</a>
                                        <a href="http://saltstack.com/services/">Integration</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Services</h4>
                                        <a href="http://saltstack.com/training/">Onsite Training</a>
                                        <a href="http://saltstack.com/services/">Custom Professional Services</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Contact Us</h4>
                                        <a href="http://saltstack.com/contact/">Support</a>
                                        <a href="http://saltstack.com/contact/">Contact us</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Community</h4>
                                        <a href="http://saltstack.org">saltstack.org</a>
                                        <a href="http://docs.saltstack.org/en/latest/">Documentation</a>
<!--                                    <a href="#">Blogs</a> -->
                                </div>
                        </div>
                            <div class="row-fluid social">
<!--                                <a href="http://www.facebook.com/SaltStack"><img src="images/socialFB.png" alt="SaltStack on Facebook" /></a> -->
                                    <a href="http://twitter.com/SaltStackInc"><img src="../../_static/images/socialTW.png" alt="SaltStack on Twitter" /></a>
                                    <a href="http://www.linkedin.com/company/salt-stack-inc"><img src="../../_static/images/socialLI.png" alt="SaltStack on LinkedIn" /></a>
<!--                                <a href="http://plus.google.com/114449193225626631691"><img src="images/socialG+.png" alt="SaltStack on Google+" /></a> -->
                                    <a href="https://github.com/saltstack"><img src="../../_static/images/socialGitHub.png" alt="SaltStack on Github" />
                            </div>
                </div>
            </footer>

        <script src="../../_static/js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-26984928-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>

        <script>llactid=23943</script>
        <script src="http://t4.trackalyzer.com/trackalyze.js"></script>
    </body>
</html>