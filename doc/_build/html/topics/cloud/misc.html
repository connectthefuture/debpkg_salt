<!DOCTYPE html>








<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Miscellaneous Salt Cloud Options</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="google-site-verification" content="1Y-ojT3ndjxA9coB77iUDyXPWxeuQ3T4_r0j-QG6QHg" />

        
    
    <link rel="stylesheet" href="../../_static/css/main.css">
    
    <link rel="stylesheet" href="../../_static/basic.css">
    <link rel="stylesheet" href="../../_static/pygments.css">

    <link rel="stylesheet" href="../../_static/css/bootstrap.css">
    <style>
        body { padding-top: 20px; }
    </style>
    <link rel="stylesheet" href="../../_static/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="../../_static/css/main.css">
        
    <script>
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '2014.1.7',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };
    </script>
    
    <script src="../../_static/js/vendor/jquery-1.9.1.js"></script>
    
    
    <script src="../../_static/js/vendor/bootstrap.min.js"></script>
    
    
    
    <script src="../../_static/underscore.js"></script>
    
    
    <script src="../../_static/doctools.js"></script>
    
        <link rel="shortcut icon" href="../../_static/favicon.ico">
        <link rel="top" title="None" href="../../index.html">
        <link rel="up" title="Salt Cloud Documentation" href="index.html">
        <link rel="next" title="Getting Started With OpenStack" href="openstack.html">
        <link rel="prev" title="Cloud Map File" href="map.html"> 
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,800italic,300,800' rel='stylesheet' type='text/css'>
        <script src="../../_static/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        
    </head>

    <body class="index">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="../../index.html"><img src="../../_static/images/SaltStack-Logo.png" /></a>
                    <div class="nav-collapse collapse">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="map.html" title="Cloud Map File">previous</a>
                
            </li>
            <li>
                <a href="openstack.html" title="Getting Started With OpenStack">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div>
                    </div>
                </div>
            </div>
        </div>
        

        <div class="content row-fluid">
            <div class="container">
                <div class="span12">
                    <div class="span9">
                        
  <div class="section" id="miscellaneous-salt-cloud-options">
<h1>Miscellaneous Salt Cloud Options<a class="headerlink" href="#miscellaneous-salt-cloud-options" title="Permalink to this headline">¶</a></h1>
<p>This page describes various miscellaneous options available in Salt Cloud</p>
<div class="section" id="deploy-script-arguments">
<h2>Deploy Script Arguments<a class="headerlink" href="#deploy-script-arguments" title="Permalink to this headline">¶</a></h2>
<p>Custom deploy scripts are unlikely to need custom arguments to be passed to
them, but salt-bootstrap has been extended quite a bit, and this may be
necessary. script_args can be specified in either the profile or the map file,
to pass arguments to the deploy script:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">ec2-amazon</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">provider</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ec2</span>
    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ami-1624987f</span>
    <span class="l-Scalar-Plain">size</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Micro Instance</span>
    <span class="l-Scalar-Plain">ssh_username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ec2-user</span>
    <span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bootstrap-salt</span>
    <span class="l-Scalar-Plain">script_args</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">-c /tmp/</span>
</pre></div>
</div>
<p>This has also been tested to work with pipes, if needed:</p>
<div class="highlight-yaml"><div class="highlight"><pre>script_args: | head
</pre></div>
</div>
</div>
<div class="section" id="sync-after-install">
<h2>Sync After Install<a class="headerlink" href="#sync-after-install" title="Permalink to this headline">¶</a></h2>
<p>Salt allows users to create custom modules, grains and states which can be
synchronised to minions to extend Salt with further functionality.</p>
<p>This option will inform Salt Cloud to synchronise your custom modules, grains,
states or all these to the minion just after it has been created. For this to
happen, the following line needs to be added to the main cloud
configuration file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">sync_after_install</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">all</span>
</pre></div>
</div>
<p>The available options for this setting are:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">modules</span>
<span class="l-Scalar-Plain">grains</span>
<span class="l-Scalar-Plain">states</span>
<span class="l-Scalar-Plain">all</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-new-salt-masters">
<h2>Setting up New Salt Masters<a class="headerlink" href="#setting-up-new-salt-masters" title="Permalink to this headline">¶</a></h2>
<p>It has become increasingly common for users to set up multi-hierarchal
infrastructures using Salt Cloud. This sometimes involves setting up an
instance to be a master in addition to a minion. With that in mind, you can
now lay down master configuration on a machine by specifying master options
in the profile or map file.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">make_master</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>This will cause Salt Cloud to generate master keys for the instance, and tell
salt-bootstrap to install the salt-master package, in addition to the
salt-minion package.</p>
<p>The default master configuration is usually appropriate for most users, and
will not be changed unless specific master configuration has been added to the
profile or map:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">master</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="l-Scalar-Plain">interface</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.0.0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="delete-ssh-keys">
<h2>Delete SSH Keys<a class="headerlink" href="#delete-ssh-keys" title="Permalink to this headline">¶</a></h2>
<p>When Salt Cloud deploys an instance, the SSH pub key for the instance is added
to the known_hosts file for the user that ran the salt-cloud command. When an
instance is deployed, a cloud provider generally recycles the IP address for
the instance.  When Salt Cloud attempts to deploy an instance using a recycled
IP address that has previously been accessed from the same machine, the old key
in the known_hosts file will cause a conflict.</p>
<p>In order to mitigate this issue, Salt Cloud can be configured to remove old
keys from the known_hosts file when destroying the node. In order to do this,
the following line needs to be added to the main cloud configuration file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">delete_sshkeys</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<div class="section" id="keeping-tmp-files">
<h2>Keeping /tmp/ Files<a class="headerlink" href="#keeping-tmp-files" title="Permalink to this headline">¶</a></h2>
<p>When Salt Cloud deploys an instance, it uploads temporary files to /tmp/ for
salt-bootstrap to put in place. After the script has run, they are deleted. To
keep these files around (mostly for debugging purposes), the --keep-tmp option
can be added:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -p myprofile mymachine --keep-tmp
</pre></div>
</div>
<p>For those wondering why /tmp/ was used instead of /root/, this had to be done
for images which require the use of sudo, and therefore do not allow remote
root logins, even for file transfers (which makes /root/ unavailable).</p>
</div>
<div class="section" id="hide-output-from-minion-install">
<h2>Hide Output From Minion Install<a class="headerlink" href="#hide-output-from-minion-install" title="Permalink to this headline">¶</a></h2>
<p>By default Salt Cloud will stream the output from the minion deploy script
directly to STDOUT. Although this can been very useful, in certain cases you
may wish to switch this off. The following config option is there to enable or
disable this output:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">display_ssh_output</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">False</span>
</pre></div>
</div>
</div>
<div class="section" id="connection-timeout">
<h2>Connection Timeout<a class="headerlink" href="#connection-timeout" title="Permalink to this headline">¶</a></h2>
<p>There are several stages when deploying Salt where Salt Cloud needs to wait for
something to happen. The VM getting it's IP address, the VM's SSH port is
available, etc.</p>
<p>If you find that the Salt Cloud defaults are not enough and your deployment
fails because Salt Cloud did not wait log enough, there are some settings you
can tweak.</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">All values should be provided in seconds</p>
</div>
<p>You can tweak these settings globally, per cloud provider, or event per profile
definition.</p>
<div class="section" id="wait-for-ip-timeout">
<h3>wait_for_ip_timeout<a class="headerlink" href="#wait-for-ip-timeout" title="Permalink to this headline">¶</a></h3>
<p>The amount of time Salt Cloud should wait for a VM to start and get an IP back
from the cloud provider. Default: 5 minutes.</p>
</div>
<div class="section" id="wait-for-ip-interval">
<h3>wait_for_ip_interval<a class="headerlink" href="#wait-for-ip-interval" title="Permalink to this headline">¶</a></h3>
<p>The amount of time Salt Cloud should sleep while querying for the VM's IP.
Default: 5 seconds.</p>
</div>
<div class="section" id="ssh-connect-timeout">
<h3>ssh_connect_timeout<a class="headerlink" href="#ssh-connect-timeout" title="Permalink to this headline">¶</a></h3>
<p>The amount of time Salt Cloud should wait for a successful SSH connection to
the VM. Default: 5 minutes.</p>
</div>
<div class="section" id="wait-for-passwd-timeout">
<h3>wait_for_passwd_timeout<a class="headerlink" href="#wait-for-passwd-timeout" title="Permalink to this headline">¶</a></h3>
<p>The amount of time until an ssh connection can be established via password or
ssh key. Default 15 seconds.</p>
</div>
<div class="section" id="wait-for-fun-timeout">
<h3>wait_for_fun_timeout<a class="headerlink" href="#wait-for-fun-timeout" title="Permalink to this headline">¶</a></h3>
<p>Some cloud drivers check for an available IP or a successful SSH connection
using a function, namely, SoftLayer and SoftLayer-HW. So, the amount of time
Salt Cloud should retry such functions before failing. Default: 5 minutes.</p>
</div>
<div class="section" id="wait-for-spot-timeout">
<h3>wait_for_spot_timeout<a class="headerlink" href="#wait-for-spot-timeout" title="Permalink to this headline">¶</a></h3>
<p>The amount of time Salt Cloud should wait before an EC2 Spot instance is
available. This setting is only available for the EC2 cloud driver.</p>
</div>
</div>
</div>


                    </div>
    <div class="span3">
    <div>

        <p>Current Salt release: <a href="../releases/2014.1.7.html">2014.1.7</a></p>

        <p class="muted">Docs for previous releases on
            <a href="http://salt.readthedocs.org">salt.rtfd.org</a>.</p>
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Miscellaneous Salt Cloud Options</a><ul>
<li><a class="reference internal" href="#deploy-script-arguments">Deploy Script Arguments</a></li>
<li><a class="reference internal" href="#sync-after-install">Sync After Install</a></li>
<li><a class="reference internal" href="#setting-up-new-salt-masters">Setting up New Salt Masters</a></li>
<li><a class="reference internal" href="#delete-ssh-keys">Delete SSH Keys</a></li>
<li><a class="reference internal" href="#keeping-tmp-files">Keeping /tmp/ Files</a></li>
<li><a class="reference internal" href="#hide-output-from-minion-install">Hide Output From Minion Install</a></li>
<li><a class="reference internal" href="#connection-timeout">Connection Timeout</a><ul>
<li><a class="reference internal" href="#wait-for-ip-timeout">wait_for_ip_timeout</a></li>
<li><a class="reference internal" href="#wait-for-ip-interval">wait_for_ip_interval</a></li>
<li><a class="reference internal" href="#ssh-connect-timeout">ssh_connect_timeout</a></li>
<li><a class="reference internal" href="#wait-for-passwd-timeout">wait_for_passwd_timeout</a></li>
<li><a class="reference internal" href="#wait-for-fun-timeout">wait_for_fun_timeout</a></li>
<li><a class="reference internal" href="#wait-for-spot-timeout">wait_for_spot_timeout</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="map.html"
                        title="previous chapter">Cloud Map File</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="openstack.html"
                        title="next chapter">Getting Started With OpenStack</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

        <h3>Upcoming SaltStack Events</h3>
        <script src="http://cdn.lanyrd.net/badges/person-v1.min.js"></script>
        <div class="lanyrd-target-splat"><a href="http://lanyrd.com/profile/saltstackinc/" class="lanyrd-splat lanyrd-number-3 lanyrd-context-future" rel="me">My conferences on Lanyrd</a></div>
    </div>
    </div>
                </div>
            </div>
        </div>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="map.html" title="Cloud Map File">previous</a>
                
            </li>
            <li>
                <a href="openstack.html" title="Getting Started With OpenStack">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div></div>
            </div>
        
            <footer>
                <div class="container">
                        <div class="row-fluid">
                                <div class="footerCol">
                                        <h4>About Us</h4>
                                        <a href="http://saltstack.com/">SaltStack</a>
                                        <a href="http://saltstack.com/about/">Leadership</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Products</h4>
                                        <a href="http://saltstack.com/enterprise/">Enterprise</a>
                                        <a href="http://saltstack.com/services/">Integration</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Services</h4>
                                        <a href="http://saltstack.com/training/">Onsite Training</a>
                                        <a href="http://saltstack.com/services/">Custom Professional Services</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Contact Us</h4>
                                        <a href="http://saltstack.com/contact/">Support</a>
                                        <a href="http://saltstack.com/contact/">Contact us</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Community</h4>
                                        <a href="http://saltstack.org">saltstack.org</a>
                                        <a href="http://docs.saltstack.org/en/latest/">Documentation</a>
<!--                                    <a href="#">Blogs</a> -->
                                </div>
                        </div>
                            <div class="row-fluid social">
<!--                                <a href="http://www.facebook.com/SaltStack"><img src="images/socialFB.png" alt="SaltStack on Facebook" /></a> -->
                                    <a href="http://twitter.com/SaltStackInc"><img src="../../_static/images/socialTW.png" alt="SaltStack on Twitter" /></a>
                                    <a href="http://www.linkedin.com/company/salt-stack-inc"><img src="../../_static/images/socialLI.png" alt="SaltStack on LinkedIn" /></a>
<!--                                <a href="http://plus.google.com/114449193225626631691"><img src="images/socialG+.png" alt="SaltStack on Google+" /></a> -->
                                    <a href="https://github.com/saltstack"><img src="../../_static/images/socialGitHub.png" alt="SaltStack on Github" />
                            </div>
                </div>
            </footer>

        <script src="../../_static/js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-26984928-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>

        <script>llactid=23943</script>
        <script src="http://t4.trackalyzer.com/trackalyze.js"></script>
    </body>
</html>