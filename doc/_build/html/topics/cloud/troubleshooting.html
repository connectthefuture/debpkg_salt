<!DOCTYPE html>








<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Troubleshooting Salt Cloud</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="google-site-verification" content="1Y-ojT3ndjxA9coB77iUDyXPWxeuQ3T4_r0j-QG6QHg" />

        
    
    <link rel="stylesheet" href="../../_static/css/main.css">
    
    <link rel="stylesheet" href="../../_static/basic.css">
    <link rel="stylesheet" href="../../_static/pygments.css">

    <link rel="stylesheet" href="../../_static/css/bootstrap.css">
    <style>
        body { padding-top: 20px; }
    </style>
    <link rel="stylesheet" href="../../_static/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="../../_static/css/main.css">
        
    <script>
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '2014.1.4',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };
    </script>
    
    <script src="../../_static/js/vendor/jquery-1.9.1.js"></script>
    
    
    <script src="../../_static/js/vendor/bootstrap.min.js"></script>
    
    
    
    <script src="../../_static/underscore.js"></script>
    
    
    <script src="../../_static/doctools.js"></script>
    
        <link rel="shortcut icon" href="../../_static/favicon.ico">
        <link rel="top" title="None" href="../../index.html">
        <link rel="up" title="Salt Cloud Documentation" href="index.html">
        <link rel="next" title="Spinning up Windows Minions" href="windows.html">
        <link rel="prev" title="Getting Started With SoftLayer" href="softlayer.html"> 
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,800italic,300,800' rel='stylesheet' type='text/css'>
        <script src="../../_static/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        
    </head>

    <body class="index">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="../../index.html"><img src="../../_static/images/SaltStack-Logo.png" /></a>
                    <div class="nav-collapse collapse">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="softlayer.html" title="Getting Started With SoftLayer">previous</a>
                
            </li>
            <li>
                <a href="windows.html" title="Spinning up Windows Minions">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div>
                    </div>
                </div>
            </div>
        </div>
        

        <div class="content row-fluid">
            <div class="container">
                <div class="span12">
                    <div class="span9">
                        
  <div class="section" id="troubleshooting-salt-cloud">
<h1>Troubleshooting Salt Cloud<a class="headerlink" href="#troubleshooting-salt-cloud" title="Permalink to this headline">¶</a></h1>
<p>This page describes various steps for troubleshooting problems that may arise
while using Salt Cloud.</p>
<div class="section" id="generic-troubleshooting-steps">
<h2>Generic Troubleshooting Steps<a class="headerlink" href="#generic-troubleshooting-steps" title="Permalink to this headline">¶</a></h2>
<p>This section describes a set of instructions that are useful to a large number
of situations, and are likely to solve most issues that arise.</p>
<div class="admonition-version-compatibility admonition">
<p class="first admonition-title">Version Compatibility</p>
<p>One of the most common issues that Salt Cloud users run into is import
errors. These are often caused by version compatibility issues with Salt.</p>
<p>Salt 0.16.x works with Salt Cloud 0.8.9 or greater.</p>
<p>Salt 0.17.x requires Salt Cloud 0.8.11.</p>
<p class="last">Releases after 0.17.x (0.18 or greater) should not encounter issues as Salt
Cloud has been merged into Salt itself.</p>
</div>
<div class="section" id="debug-mode">
<h3>Debug Mode<a class="headerlink" href="#debug-mode" title="Permalink to this headline">¶</a></h3>
<p>Frequently, running Salt Cloud in debug mode will reveal information about a
deployment which would otherwise not be obvious:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -p myprofile myinstance -l debug
</pre></div>
</div>
<p>Keep in mind that a number of messages will appear that look at first like
errors, but are in fact intended to give developers factual information to
assist in debugging. A number of messages that appear will be for cloud
providers that you do not have configured; in these cases, the message usually
is intended to confirm that they are not configured.</p>
</div>
<div class="section" id="salt-bootstrap">
<h3>Salt Bootstrap<a class="headerlink" href="#salt-bootstrap" title="Permalink to this headline">¶</a></h3>
<p>By default, Salt Cloud uses the Salt Bootstrap script to provision instances:</p>
<p>This script is packaged with Salt Cloud, but may be updated without updating
the Salt package:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -u
</pre></div>
</div>
</div>
<div class="section" id="the-bootstrap-log">
<h3>The Bootstrap Log<a class="headerlink" href="#the-bootstrap-log" title="Permalink to this headline">¶</a></h3>
<p>If the default deploy script was used, there should be a file in the <tt class="docutils literal"><span class="pre">/tmp/</span></tt>
directory called <tt class="docutils literal"><span class="pre">bootstrap-salt.log</span></tt>. This file contains the full output from
the deployment, including any errors that may have occurred.</p>
</div>
<div class="section" id="keeping-temp-files">
<h3>Keeping Temp Files<a class="headerlink" href="#keeping-temp-files" title="Permalink to this headline">¶</a></h3>
<p>Salt Cloud uploads minion-specific files to instances once they are available
via SSH, and then executes a deploy script to put them into the correct place
and install Salt. The <tt class="docutils literal"><span class="pre">--keep-tmp</span></tt> option will instruct Salt Cloud not to
remove those files when finished with them, so that the user may inspect them
for problems:</p>
<div class="highlight-bash"><div class="highlight"><pre>salt-cloud -p myprofile myinstance --keep-tmp
</pre></div>
</div>
<p>By default, Salt Cloud will create a directory on the target instance called
<tt class="docutils literal"><span class="pre">/tmp/.saltcloud/</span></tt>. This directory should be owned by the user that is to
execute the deploy script, and should have permissions of <tt class="docutils literal"><span class="pre">0700</span></tt>.</p>
<p>Most cloud providers are configured to use <tt class="docutils literal"><span class="pre">root</span></tt> as the default initial user
for deployment, and as such, this directory and all files in it should be owned
by the <tt class="docutils literal"><span class="pre">root</span></tt> user.</p>
<p>The <tt class="docutils literal"><span class="pre">/tmp/.saltcloud/</span></tt> directory should the following files:</p>
<ul class="simple">
<li>A <tt class="docutils literal"><span class="pre">deploy.sh</span></tt> script. This script should have permissions of <tt class="docutils literal"><span class="pre">0755</span></tt>.</li>
<li>A <tt class="docutils literal"><span class="pre">.pem</span></tt> and <tt class="docutils literal"><span class="pre">.pub</span></tt> key named after the minion. The <tt class="docutils literal"><span class="pre">.pem</span></tt> file should
have permissions of <tt class="docutils literal"><span class="pre">0600</span></tt>. Ensure that the <tt class="docutils literal"><span class="pre">.pem</span></tt> and <tt class="docutils literal"><span class="pre">.pub</span></tt> files have
been properly copied to the <tt class="docutils literal"><span class="pre">/etc/salt/pki/minion/</span></tt> directory.</li>
<li>A file called <tt class="docutils literal"><span class="pre">minion</span></tt>. This file should have been copied to the
<tt class="docutils literal"><span class="pre">/etc/salt/</span></tt> directory.</li>
<li>Optionally, a file called <tt class="docutils literal"><span class="pre">grains</span></tt>. This file, if present, should have been
copied to the <tt class="docutils literal"><span class="pre">/etc/salt/</span></tt> directory.</li>
</ul>
</div>
<div class="section" id="unprivileged-primary-users">
<h3>Unprivileged Primary Users<a class="headerlink" href="#unprivileged-primary-users" title="Permalink to this headline">¶</a></h3>
<p>Some providers, most notably EC2, are configured with a different primary user.
Some common examples are <tt class="docutils literal"><span class="pre">ec2-user</span></tt>, <tt class="docutils literal"><span class="pre">ubuntu</span></tt>, <tt class="docutils literal"><span class="pre">fedora</span></tt> and <tt class="docutils literal"><span class="pre">bitnami</span></tt>.
In these cases, the <tt class="docutils literal"><span class="pre">/tmp/.saltcloud/</span></tt> directory and all files in it should
be owned by this user.</p>
<p>Some providers, such as EC2, are configured to not require these users to
provide a password when using the <tt class="docutils literal"><span class="pre">sudo</span></tt> command. Because it is more secure
to require <tt class="docutils literal"><span class="pre">sudo</span></tt> users to provide a password, other providers are configured
that way.</p>
<p>If this instance is required to provide a password, it needs to be configured
in Salt Cloud. A password for sudo to use may be added to either the provider
configuration or the profile configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">sudo_password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mypassword</span>
</pre></div>
</div>
</div>
<div class="section" id="tmp-is-mounted-as-noexec">
<h3><tt class="docutils literal"><span class="pre">/tmp/</span></tt> is Mounted as <tt class="docutils literal"><span class="pre">noexec</span></tt><a class="headerlink" href="#tmp-is-mounted-as-noexec" title="Permalink to this headline">¶</a></h3>
<p>It is more secure to mount the <tt class="docutils literal"><span class="pre">/tmp/</span></tt> directory with a <tt class="docutils literal"><span class="pre">noexec</span></tt> option.
This is uncommon on most cloud providers, but very common in private
environments. To see if the <tt class="docutils literal"><span class="pre">/tmp/</span></tt> directory is mounted this way, run the
following command:</p>
<div class="highlight-bash"><div class="highlight"><pre>mount | grep tmp
</pre></div>
</div>
<p>The if the output of this command includes a line that looks like this, then
the <tt class="docutils literal"><span class="pre">/tmp/</span></tt> directory is mounted as <tt class="docutils literal"><span class="pre">noexec</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>tmpfs on /tmp <span class="nb">type </span>tmpfs <span class="o">(</span>rw,noexec<span class="o">)</span>
</pre></div>
</div>
<p>If this is the case, then the <tt class="docutils literal"><span class="pre">deploy_command</span></tt> will need to be changed
in order to run the deploy script through the <tt class="docutils literal"><span class="pre">sh</span></tt> command, rather than trying
to execute it directly. This may be specified in either the provider or the
profile config:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">deploy_command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sh /tmp/.saltcloud/deploy.sh</span>
</pre></div>
</div>
<p>Please note that by default, Salt Cloud will place its files in a directory
called <tt class="docutils literal"><span class="pre">/tmp/.saltcloud/</span></tt>. This may be also be changed in the provider or
profile configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">tmp_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/tmp/.saltcloud/</span>
</pre></div>
</div>
<p>If this directory is changed, then the <tt class="docutils literal"><span class="pre">deploy_command</span></tt> need to be changed
in order to reflect the <tt class="docutils literal"><span class="pre">tmp_dir</span></tt> configuration.</p>
</div>
<div class="section" id="executing-the-deploy-script-manually">
<h3>Executing the Deploy Script Manually<a class="headerlink" href="#executing-the-deploy-script-manually" title="Permalink to this headline">¶</a></h3>
<p>If all of the files needed for deployment were successfully uploaded to the
correct locations, and contain the correct permissions and ownerships, the
deploy script may be executed manually in order to check for other issues:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /tmp/.saltcloud/
./deploy.sh
</pre></div>
</div>
</div>
</div>
</div>


                    </div>
    <div class="span3">
    <div>

        <p>Current Salt release: <a href="../releases/2014.1.4.html">2014.1.4</a></p>

        <p class="muted">Docs for previous releases on
            <a href="http://salt.readthedocs.org">salt.rtfd.org</a>.</p>
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Troubleshooting Salt Cloud</a><ul>
<li><a class="reference internal" href="#generic-troubleshooting-steps">Generic Troubleshooting Steps</a><ul>
<li><a class="reference internal" href="#debug-mode">Debug Mode</a></li>
<li><a class="reference internal" href="#salt-bootstrap">Salt Bootstrap</a></li>
<li><a class="reference internal" href="#the-bootstrap-log">The Bootstrap Log</a></li>
<li><a class="reference internal" href="#keeping-temp-files">Keeping Temp Files</a></li>
<li><a class="reference internal" href="#unprivileged-primary-users">Unprivileged Primary Users</a></li>
<li><a class="reference internal" href="#tmp-is-mounted-as-noexec"><tt class="docutils literal"><span class="pre">/tmp/</span></tt> is Mounted as <tt class="docutils literal"><span class="pre">noexec</span></tt></a></li>
<li><a class="reference internal" href="#executing-the-deploy-script-manually">Executing the Deploy Script Manually</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="softlayer.html"
                        title="previous chapter">Getting Started With SoftLayer</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="windows.html"
                        title="next chapter">Spinning up Windows Minions</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

        <h3>Upcoming SaltStack Events</h3>
        <script src="http://cdn.lanyrd.net/badges/person-v1.min.js"></script>
        <div class="lanyrd-target-splat"><a href="http://lanyrd.com/profile/saltstackinc/" class="lanyrd-splat lanyrd-number-3 lanyrd-context-future" rel="me">My conferences on Lanyrd</a></div>
    </div>
    </div>
                </div>
            </div>
        </div>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="softlayer.html" title="Getting Started With SoftLayer">previous</a>
                
            </li>
            <li>
                <a href="windows.html" title="Spinning up Windows Minions">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div></div>
            </div>
        
            <footer>
                <div class="container">
                        <div class="row-fluid">
                                <div class="footerCol">
                                        <h4>About Us</h4>
                                        <a href="http://saltstack.com/">SaltStack</a>
                                        <a href="http://saltstack.com/about/">Leadership</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Products</h4>
                                        <a href="http://saltstack.com/enterprise/">Enterprise</a>
                                        <a href="http://saltstack.com/services/">Integration</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Services</h4>
                                        <a href="http://saltstack.com/training/">Onsite Training</a>
                                        <a href="http://saltstack.com/services/">Custom Professional Services</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Contact Us</h4>
                                        <a href="http://saltstack.com/contact/">Support</a>
                                        <a href="http://saltstack.com/contact/">Contact us</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Community</h4>
                                        <a href="http://saltstack.org">saltstack.org</a>
                                        <a href="http://docs.saltstack.org/en/latest/">Documentation</a>
<!--                                    <a href="#">Blogs</a> -->
                                </div>
                        </div>
                            <div class="row-fluid social">
<!--                                <a href="http://www.facebook.com/SaltStack"><img src="images/socialFB.png" alt="SaltStack on Facebook" /></a> -->
                                    <a href="http://twitter.com/SaltStackInc"><img src="../../_static/images/socialTW.png" alt="SaltStack on Twitter" /></a>
                                    <a href="http://www.linkedin.com/company/salt-stack-inc"><img src="../../_static/images/socialLI.png" alt="SaltStack on LinkedIn" /></a>
<!--                                <a href="http://plus.google.com/114449193225626631691"><img src="images/socialG+.png" alt="SaltStack on Google+" /></a> -->
                                    <a href="https://github.com/saltstack"><img src="../../_static/images/socialGitHub.png" alt="SaltStack on Github" />
                            </div>
                </div>
            </footer>

        <script src="../../_static/js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-26984928-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>

        <script>llactid=23943</script>
        <script src="http://t4.trackalyzer.com/trackalyze.js"></script>
    </body>
</html>