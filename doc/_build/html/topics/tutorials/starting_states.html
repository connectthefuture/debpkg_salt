<!DOCTYPE html>








<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>How Do I Use Salt States?</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="google-site-verification" content="1Y-ojT3ndjxA9coB77iUDyXPWxeuQ3T4_r0j-QG6QHg" />

        
    
    <link rel="stylesheet" href="../../_static/css/main.css">
    
    <link rel="stylesheet" href="../../_static/basic.css">
    <link rel="stylesheet" href="../../_static/pygments.css">

    <link rel="stylesheet" href="../../_static/css/bootstrap.css">
    <style>
        body { padding-top: 20px; }
    </style>
    <link rel="stylesheet" href="../../_static/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="../../_static/css/main.css">
        
    <script>
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '2014.1.4',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };
    </script>
    
    <script src="../../_static/js/vendor/jquery-1.9.1.js"></script>
    
    
    <script src="../../_static/js/vendor/bootstrap.min.js"></script>
    
    
    
    <script src="../../_static/underscore.js"></script>
    
    
    <script src="../../_static/doctools.js"></script>
    
        <link rel="shortcut icon" href="../../_static/favicon.ico">
        <link rel="top" title="None" href="../../index.html">
        <link rel="up" title="Salt tutorials" href="index.html">
        <link rel="next" title="States tutorial, part 1 - Basic Usage" href="states_pt1.html">
        <link rel="prev" title="Pillar Walkthrough" href="pillar.html"> 
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,800italic,300,800' rel='stylesheet' type='text/css'>
        <script src="../../_static/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        
    </head>

    <body class="index">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="../../index.html"><img src="../../_static/images/SaltStack-Logo.png" /></a>
                    <div class="nav-collapse collapse">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="pillar.html" title="Pillar Walkthrough">previous</a>
                
            </li>
            <li>
                <a href="states_pt1.html" title="States tutorial, part 1 - Basic Usage">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div>
                    </div>
                </div>
            </div>
        </div>
        

        <div class="content row-fluid">
            <div class="container">
                <div class="span12">
                    <div class="span9">
                        
  <div class="section" id="how-do-i-use-salt-states">
<h1>How Do I Use Salt States?<a class="headerlink" href="#how-do-i-use-salt-states" title="Permalink to this headline">¶</a></h1>
<p>Simplicity, Simplicity, Simplicity</p>
<p>Many of the most powerful and useful engineering solutions are founded on
simple principles. Salt States strive to do just that: K.I.S.S. (Keep It
Stupidly Simple)</p>
<p>The core of the Salt State system is the SLS, or <strong>S</strong>a<strong>L</strong>t
<strong>S</strong>tate file. The SLS is a representation of the state in which
a system should be in, and is set up to contain this data in a simple format.
This is often called configuration management.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is just the beginning of using states, make sure to read up on pillar
<a class="reference internal" href="pillar.html"><em>Pillar</em></a> next.</p>
</div>
<div class="section" id="it-is-all-just-data">
<h2>It is All Just Data<a class="headerlink" href="#it-is-all-just-data" title="Permalink to this headline">¶</a></h2>
<p>Before delving into the particulars, it will help to understand that the SLS
file is just a data structure under the hood. While understanding that the SLS
is just a data structure isn't critical for understanding and making use of
Salt States, it should help bolster knowledge of where the real power is.</p>
<p>SLS files are therefore, in reality, just <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#typesmapping" title="(in Python v2.7)"><em class="xref std std-ref">dictionaries</em></a>, <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#typesseq" title="(in Python v2.7)"><em class="xref std std-ref">lists</em></a>, <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#typesseq" title="(in Python v2.7)"><em class="xref std std-ref">strings</em></a>, and <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#typesnumeric" title="(in Python v2.7)"><em class="xref std std-ref">numbers</em></a>.
By using this approach Salt can be much more flexible. As one writes more state
files, it becomes clearer exactly what is being written. The result is a system
that is easy to understand, yet grows with the needs of the admin or developer.</p>
</div>
<div class="section" id="the-top-file">
<h2>The Top File<a class="headerlink" href="#the-top-file" title="Permalink to this headline">¶</a></h2>
<p>The example SLS files in the below sections can be assigned to hosts using a
file called <strong>top.sls</strong>. This file is described in-depth <a class="reference internal" href="../../ref/states/top.html"><em>here</em></a>.</p>
</div>
<div class="section" id="default-data-yaml">
<h2>Default Data - YAML<a class="headerlink" href="#default-data-yaml" title="Permalink to this headline">¶</a></h2>
<p>By default Salt represents the SLS data in what is one of the simplest
serialization formats available - <a class="reference external" href="http://yaml.org/spec/1.1/">YAML</a>.</p>
<p>A typical SLS file will often look like this in YAML:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>These demos use some generic service and package names, different
distributions often use different names for packages and services. For
instance <cite>apache</cite> should be replaced with <cite>httpd</cite> on a Red Hat system.
Salt uses the name of the init script, systemd name, upstart name etc.
based on what the underlying service management for the platform. To
get a list of the available service names on a platform execute the
service.get_all salt function.</p>
<p class="last">Information on how to make states work with multiple distributions
is later in the tutorial.</p>
</div>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">apache</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>
  <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">running</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">apache</span>
</pre></div>
</div>
<p>This SLS data will ensure that the package named apache is installed, and
that the apache service is running. The components can be explained in a
simple way.</p>
<p>The first line is the ID for a set of data, and it is called the ID
Declaration. This ID sets the name of the thing that needs to be manipulated.</p>
<p>The second and fourth lines are the start of the State Declarations, so they
are using the pkg and service states respectively. The pkg state manages a
software package to be installed via the system's native package manager,
and the service state manages a system daemon.</p>
<p>The third and fifth lines are the function to run. This function defines what
state the named package and service should be in. Here, the package is to be
installed, and the service should be running.</p>
<p>Finally, on line six, is the word <tt class="docutils literal"><span class="pre">require</span></tt>. This is called a Requisite
Statement, and it makes sure that the Apache service is only started after
a successful installation of the apache package.</p>
</div>
<div class="section" id="adding-configs-and-users">
<h2>Adding Configs and Users<a class="headerlink" href="#adding-configs-and-users" title="Permalink to this headline">¶</a></h2>
<p>When setting up a service like an Apache web server, many more components may
need to be added. The Apache configuration file will most likely be managed,
and a user and group may need to be set up.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">apache</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">installed</span>
  <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">running</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">watch</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">apache</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/httpd/conf/httpd.conf</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">apache</span>
  <span class="l-Scalar-Plain">user.present</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">uid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">87</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">gid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">87</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">home</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/var/www/html</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/bin/nologin</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">apache</span>
  <span class="l-Scalar-Plain">group.present</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">gid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">87</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">apache</span>

<span class="l-Scalar-Plain">/etc/httpd/conf/httpd.conf</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file.managed</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://apache/httpd.conf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">644</span>
</pre></div>
</div>
<p>This SLS data greatly extends the first example, and includes a config file,
a user, a group and new requisite statement: <tt class="docutils literal"><span class="pre">watch</span></tt>.</p>
<p>Adding more states is easy, since the new user and group states are under
the Apache ID, the user and group will be the Apache user and group. The
<tt class="docutils literal"><span class="pre">require</span></tt> statements will make sure that the user will only be made after
the group, and that the group will be made only after the Apache package is
installed.</p>
<p>Next,the <tt class="docutils literal"><span class="pre">require</span></tt> statement under service was changed to watch, and is
now watching 3 states instead of just one. The watch statement does the same
thing as require, making sure that the other states run before running the
state with a watch, but it adds an extra component. The <tt class="docutils literal"><span class="pre">watch</span></tt> statement
will run the state's watcher function for any changes to the watched states.
So if the package was updated, the config file changed, or the user
uid modified, then the service state's watcher will be run. The service
state's watcher just restarts the service, so in this case, a change in the
config file will also trigger a restart of the respective service.</p>
</div>
<div class="section" id="moving-beyond-a-single-sls">
<h2>Moving Beyond a Single SLS<a class="headerlink" href="#moving-beyond-a-single-sls" title="Permalink to this headline">¶</a></h2>
<p>When setting up Salt States in a scalable manner, more than one SLS will need
to be used. The above examples were in a single SLS file, but two or more
SLS files can be combined to build out a State Tree. The above example also
references a file with a strange source - <tt class="docutils literal"><span class="pre">salt://apache/httpd.conf</span></tt>. That
file will need to be available as well.</p>
<p>The SLS files are laid out in a directory structure on the Salt master; an
SLS is just a file and files to download are just files.</p>
<p>The Apache example would be laid out in the root of the Salt file server like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">apache</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">sls</span>
<span class="n">apache</span><span class="o">/</span><span class="n">httpd</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>So the httpd.conf is just a file in the apache directory, and is referenced
directly.</p>
<p>But when using more than one single SLS file, more components can be added to
the toolkit. Consider this SSH example:</p>
<p><tt class="docutils literal"><span class="pre">ssh/init.sls:</span></tt></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">openssh-client</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg.installed</span>

<span class="l-Scalar-Plain">/etc/ssh/ssh_config</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file.managed</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">644</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://ssh/ssh_config</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openssh-client</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">ssh/server.sls:</span></tt></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ssh</span>

<span class="l-Scalar-Plain">openssh-server</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg.installed</span>

<span class="l-Scalar-Plain">sshd</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">service.running</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openssh-client</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openssh-server</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/ssh/banner</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/ssh/sshd_config</span>

<span class="l-Scalar-Plain">/etc/ssh/sshd_config</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file.managed</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">644</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://ssh/sshd_config</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openssh-server</span>

<span class="l-Scalar-Plain">/etc/ssh/banner</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">managed</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">644</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://ssh/banner</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">require</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openssh-server</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice that we use two similar ways of denoting that a file
is managed by Salt. In the <cite>/etc/ssh/sshd_config</cite> state section above,
we use the <cite>file.managed</cite> state declaration whereas with the
<cite>/etc/ssh/banner</cite> state section, we use the <cite>file</cite> state declaration
and add a <cite>managed</cite> attribute to that state declaration. Both ways
produce an identical result; the first way -- using <cite>file.managed</cite> --
is merely a shortcut.</p>
</div>
<p>Now our State Tree looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">apache</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">sls</span>
<span class="n">apache</span><span class="o">/</span><span class="n">httpd</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ssh</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">sls</span>
<span class="n">ssh</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">sls</span>
<span class="n">ssh</span><span class="o">/</span><span class="n">banner</span>
<span class="n">ssh</span><span class="o">/</span><span class="n">ssh_config</span>
<span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
</pre></div>
</div>
<p>This example now introduces the <tt class="docutils literal"><span class="pre">include</span></tt> statement. The include statement
includes another SLS file so that components found in it can be required,
watched or as will soon be demonstrated - extended.</p>
<p>The include statement allows for states to be cross linked. When an SLS
has an include statement it is literally extended to include the contents of
the included SLS files.</p>
<p>Note that some of the SLS files are called init.sls, while others are not. More
info on what this means can be found in the <a class="reference internal" href="states_pt1.html#sls-file-namespace"><em>States Tutorial</em></a>.</p>
</div>
<div class="section" id="extending-included-sls-data">
<h2>Extending Included SLS Data<a class="headerlink" href="#extending-included-sls-data" title="Permalink to this headline">¶</a></h2>
<p>Sometimes SLS data needs to be extended. Perhaps the apache service needs to
watch additional resources, or under certain circumstances a different file
needs to be placed.</p>
<p>In these examples, the first will add a custom banner to ssh and the second will
add more watchers to apache to include mod_python.</p>
<p><tt class="docutils literal"><span class="pre">ssh/custom-server.sls:</span></tt></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ssh.server</span>

<span class="l-Scalar-Plain">extend</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">/etc/ssh/banner</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">file</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://ssh/custom-banner</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">python/mod_python.sls:</span></tt></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">apache</span>

<span class="l-Scalar-Plain">extend</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">apache</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">watch</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mod_python</span>

<span class="l-Scalar-Plain">mod_python</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg.installed</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">custom-server.sls</span></tt> file uses the extend statement to overwrite where the
banner is being downloaded from, and therefore changing what file is being used
to configure the banner.</p>
<p>In the new mod_python SLS the mod_python package is added, but more importantly
the apache service was extended to also watch the mod_python package.</p>
<div class="admonition-using-extend-with-require-or-watch admonition">
<p class="first admonition-title">Using extend with require or watch</p>
<p class="last">The <tt class="docutils literal"><span class="pre">extend</span></tt> statement works differently for <tt class="docutils literal"><span class="pre">require</span></tt> or <tt class="docutils literal"><span class="pre">watch</span></tt>.
It appends to, rather than replacing the requisite component.</p>
</div>
</div>
<div class="section" id="understanding-the-render-system">
<h2>Understanding the Render System<a class="headerlink" href="#understanding-the-render-system" title="Permalink to this headline">¶</a></h2>
<p>Since SLS data is simply that (data), it does not need to be represented
with YAML. Salt defaults to YAML because it is very straightforward and easy
to learn and use. But the SLS files can be rendered from almost any imaginable
medium, so long as a renderer module is provided.</p>
<p>The default rendering system is the <tt class="docutils literal"><span class="pre">yaml_jinja</span></tt> renderer. The
<tt class="docutils literal"><span class="pre">yaml_jinja</span></tt> renderer will first pass the template through the <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a>
templating system, and then through the YAML parser. The benefit here is that
full programming constructs are available when creating SLS files.</p>
<p>Other renderers available are <tt class="docutils literal"><span class="pre">yaml_mako</span></tt> and <tt class="docutils literal"><span class="pre">yaml_wempy</span></tt> which each use
the <a class="reference external" href="http://www.makotemplates.org/">Mako</a> or <a class="reference external" href="http://www.wempy.org/">Wempy</a> templating system respectively rather than the jinja
templating system, and more notably, the pure Python or <tt class="docutils literal"><span class="pre">py</span></tt> and <tt class="docutils literal"><span class="pre">pydsl</span></tt>
renderers.
The <tt class="docutils literal"><span class="pre">py</span></tt> renderer allows for SLS files to be written in pure Python,
allowing for the utmost level of flexibility and power when preparing SLS
data; while the <a class="reference internal" href="../../ref/renderers/all/salt.renderers.pydsl.html"><em>pydsl</em></a> renderer
provides a flexible, domain-specific language for authoring SLS data in Python.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The templating engines described above aren't just available in SLS files.
They can also be used in <a class="reference internal" href="../../ref/states/all/salt.states.file.html#salt.states.file.managed" title="salt.states.file.managed"><tt class="xref py py-mod docutils literal"><span class="pre">file.managed</span></tt></a>
states, making file management much more dynamic and flexible. Some
examples for using templates in managed files can be found in the
documentation for the <a class="reference internal" href="../../ref/states/all/salt.states.file.html"><em>file states</em></a>, as well as the <a class="reference internal" href="#jinja-example-moosefs"><em>MooseFS
example</em></a> below.</p>
</div>
<div class="section" id="getting-to-know-the-default-yaml-jinja">
<h3>Getting to Know the Default - yaml_jinja<a class="headerlink" href="#getting-to-know-the-default-yaml-jinja" title="Permalink to this headline">¶</a></h3>
<p>The default renderer - <tt class="docutils literal"><span class="pre">yaml_jinja</span></tt>, allows for use of the jinja
templating system. A guide to the Jinja templating system can be found here:
<a class="reference external" href="http://jinja.pocoo.org/docs">http://jinja.pocoo.org/docs</a></p>
<p>When working with renderers a few very useful bits of data are passed in. In
the case of templating engine based renderers, three critical components are
available, <tt class="docutils literal"><span class="pre">salt</span></tt>, <tt class="docutils literal"><span class="pre">grains</span></tt>, and <tt class="docutils literal"><span class="pre">pillar</span></tt>. The <tt class="docutils literal"><span class="pre">salt</span></tt> object allows for
any Salt function to be called from within the template, and <tt class="docutils literal"><span class="pre">grains</span></tt> allows
for the Grains to be accessed from within the template. A few examples:</p>
<p><tt class="docutils literal"><span class="pre">apache/init.sls:</span></tt></p>
<div class="highlight-yaml"><div class="highlight"><pre>apache:
  pkg.installed:
    {% if grains[&#39;os&#39;] == &#39;RedHat&#39;%}
    - name: httpd
    {% endif %}
  service.running:
    {% if grains[&#39;os&#39;] == &#39;RedHat&#39;%}
    - name: httpd
    {% endif %}
    - watch:
      - pkg: apache
      - file: /etc/httpd/conf/httpd.conf
      - user: apache
  user.present:
    - uid: 87
    - gid: 87
    - home: /var/www/html
    - shell: /bin/nologin
    - require:
      - group: apache
  group.present:
    - gid: 87
    - require:
      - pkg: apache

/etc/httpd/conf/httpd.conf:
  file.managed:
    - source: salt://apache/httpd.conf
    - user: root
    - group: root
    - mode: 644
</pre></div>
</div>
<p>This example is simple. If the <tt class="docutils literal"><span class="pre">os</span></tt> grain states that the operating system is
Red Hat, then the name of the Apache package and service needs to be httpd.</p>
<p id="jinja-example-moosefs">A more aggressive way to use Jinja can be found here, in a module to set up
a MooseFS distributed filesystem chunkserver:</p>
<p><tt class="docutils literal"><span class="pre">moosefs/chunk.sls:</span></tt></p>
<div class="highlight-yaml"><div class="highlight"><pre>include:
  - moosefs

{% for mnt in salt[&#39;cmd.run&#39;](&#39;ls /dev/data/moose*&#39;).split() %}
/mnt/moose{{ mnt[-1] }}:
  mount.mounted:
    - device: {{ mnt }}
    - fstype: xfs
    - mkmnt: True
  file.directory:
    - user: mfs
    - group: mfs
    - require:
      - user: mfs
      - group: mfs
{% endfor %}

/etc/mfshdd.cfg:
  file.managed:
    - source: salt://moosefs/mfshdd.cfg
    - user: root
    - group: root
    - mode: 644
    - template: jinja
    - require:
      - pkg: mfs-chunkserver

/etc/mfschunkserver.cfg:
  file.managed:
    - source: salt://moosefs/mfschunkserver.cfg
    - user: root
    - group: root
    - mode: 644
    - template: jinja
    - require:
      - pkg: mfs-chunkserver

mfs-chunkserver:
  pkg:
    - installed
mfschunkserver:
  service:
    - running
    - require:
{% for mnt in salt[&#39;cmd.run&#39;](&#39;ls /dev/data/moose*&#39;) %}
      - mount: /mnt/moose{{ mnt[-1] }}
      - file: /mnt/moose{{ mnt[-1] }}
{% endfor %}
      - file: /etc/mfschunkserver.cfg
      - file: /etc/mfshdd.cfg
      - file: /var/lib/mfs
</pre></div>
</div>
<p>This example shows much more of the available power of Jinja.
Multiple for loops are used to dynamically detect available hard drives
and set them up to be mounted, and the <tt class="docutils literal"><span class="pre">salt</span></tt> object is used multiple
times to call shell commands to gather data.</p>
</div>
<div class="section" id="introducing-the-python-and-the-pydsl-renderers">
<h3>Introducing the Python and the PyDSL Renderers<a class="headerlink" href="#introducing-the-python-and-the-pydsl-renderers" title="Permalink to this headline">¶</a></h3>
<p>Sometimes the chosen default renderer might not have enough logical power to
accomplish the needed task. When this happens, the Python renderer can be
used. Normally a YAML renderer should be used for the majority of SLS files,
but an SLS file set to use another renderer can be easily added to the tree.</p>
<p>This example shows a very basic Python SLS file:</p>
<p><tt class="docutils literal"><span class="pre">python/django.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!py</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Install the django package</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;include&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;python&#39;</span><span class="p">],</span>
            <span class="s">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;pkg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;installed&#39;</span><span class="p">]}}</span>
</pre></div>
</div>
<p>This is a very simple example; the first line has an SLS shebang that
tells Salt to not use the default renderer, but to use the <tt class="docutils literal"><span class="pre">py</span></tt> renderer.
Then the run function is defined, the return value from the run function
must be a Salt friendly data structure, or better known as a Salt
<a class="reference internal" href="../../ref/states/highstate.html"><em>HighState data structure</em></a>.</p>
<p>Alternatively, using the <a class="reference internal" href="../../ref/renderers/all/salt.renderers.pydsl.html"><em>pydsl</em></a>
renderer, the above example can be written more succinctly as:</p>
<p><tt class="docutils literal"><span class="pre">python/django.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!pydsl</span>

<span class="n">include</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">,</span> <span class="n">delayed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">state</span><span class="p">(</span><span class="s">&#39;django&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pkg</span><span class="o">.</span><span class="n">installed</span><span class="p">()</span>
</pre></div>
</div>
<p>This Python examples would look like this if they were written in YAML:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">python</span>

<span class="l-Scalar-Plain">django</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pkg.installed</span>
</pre></div>
</div>
<p>This example clearly illustrates that; one, using the YAML renderer by default
is a wise decision and two, unbridled power can be obtained where needed by
using a pure Python SLS.</p>
</div>
<div class="section" id="running-and-debugging-salt-states">
<h3>Running and debugging salt states.<a class="headerlink" href="#running-and-debugging-salt-states" title="Permalink to this headline">¶</a></h3>
<p>Once the rules in an SLS are ready, they should be tested to ensure they
work properly. To invoke these rules, simply execute
<tt class="docutils literal"><span class="pre">salt</span> <span class="pre">'*'</span> <span class="pre">state.highstate</span></tt> on the command line. If you get back only
hostnames with a <tt class="docutils literal"><span class="pre">:</span></tt> after, but no return, chances are there is a problem with
one or more of the sls files. On the minion, use the <tt class="docutils literal"><span class="pre">salt-call</span></tt> command:
<tt class="docutils literal"><span class="pre">salt-call</span> <span class="pre">state.highstate</span> <span class="pre">-l</span> <span class="pre">debug</span></tt> to examine the output for errors.
This should help troubleshoot the issue. The minions can also be started in
the foreground in debug mode: <tt class="docutils literal"><span class="pre">salt-minion</span> <span class="pre">-l</span> <span class="pre">debug</span></tt>.</p>
</div>
</div>
<div class="section" id="next-reading">
<h2>Next Reading<a class="headerlink" href="#next-reading" title="Permalink to this headline">¶</a></h2>
<p>With an understanding of states, the next recommendation is to become familiar
with Salt's pillar interface:</p>
<blockquote>
<div><a class="reference internal" href="pillar.html"><em>Pillar Walkthrough</em></a></div></blockquote>
</div>
</div>


                    </div>
    <div class="span3">
    <div>

        <p>Current Salt release: <a href="../releases/2014.1.4.html">2014.1.4</a></p>

        <p class="muted">Docs for previous releases on
            <a href="http://salt.readthedocs.org">salt.rtfd.org</a>.</p>
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How Do I Use Salt States?</a><ul>
<li><a class="reference internal" href="#it-is-all-just-data">It is All Just Data</a></li>
<li><a class="reference internal" href="#the-top-file">The Top File</a></li>
<li><a class="reference internal" href="#default-data-yaml">Default Data - YAML</a></li>
<li><a class="reference internal" href="#adding-configs-and-users">Adding Configs and Users</a></li>
<li><a class="reference internal" href="#moving-beyond-a-single-sls">Moving Beyond a Single SLS</a></li>
<li><a class="reference internal" href="#extending-included-sls-data">Extending Included SLS Data</a></li>
<li><a class="reference internal" href="#understanding-the-render-system">Understanding the Render System</a><ul>
<li><a class="reference internal" href="#getting-to-know-the-default-yaml-jinja">Getting to Know the Default - yaml_jinja</a></li>
<li><a class="reference internal" href="#introducing-the-python-and-the-pydsl-renderers">Introducing the Python and the PyDSL Renderers</a></li>
<li><a class="reference internal" href="#running-and-debugging-salt-states">Running and debugging salt states.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#next-reading">Next Reading</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pillar.html"
                        title="previous chapter">Pillar Walkthrough</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="states_pt1.html"
                        title="next chapter">States tutorial, part 1 - Basic Usage</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

        <h3>Upcoming SaltStack Events</h3>
        <script src="http://cdn.lanyrd.net/badges/person-v1.min.js"></script>
        <div class="lanyrd-target-splat"><a href="http://lanyrd.com/profile/saltstackinc/" class="lanyrd-splat lanyrd-number-3 lanyrd-context-future" rel="me">My conferences on Lanyrd</a></div>
    </div>
    </div>
                </div>
            </div>
        </div>
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
    <div class="related">
        

        <ul class="nav rel-extra">
            <li>
                <a href="pillar.html" title="Pillar Walkthrough">previous</a>
                
            </li>
            <li>
                <a href="states_pt1.html" title="States tutorial, part 1 - Basic Usage">next</a>
                
            </li>
            <li>
                <a href="../../salt-modindex.html" title="Salt Module Index">all salt modules</a>
                
            </li>
            <li>
                <a href="../../genindex.html" title="General Index">index</a>
                
            </li> 
        </ul>
    </div></div>
            </div>
        
            <footer>
                <div class="container">
                        <div class="row-fluid">
                                <div class="footerCol">
                                        <h4>About Us</h4>
                                        <a href="http://saltstack.com/">SaltStack</a>
                                        <a href="http://saltstack.com/about/">Leadership</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Products</h4>
                                        <a href="http://saltstack.com/enterprise/">Enterprise</a>
                                        <a href="http://saltstack.com/services/">Integration</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Services</h4>
                                        <a href="http://saltstack.com/training/">Onsite Training</a>
                                        <a href="http://saltstack.com/services/">Custom Professional Services</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Contact Us</h4>
                                        <a href="http://saltstack.com/contact/">Support</a>
                                        <a href="http://saltstack.com/contact/">Contact us</a>
                                </div>
                                <div class="footerCol">
                                        <h4>Community</h4>
                                        <a href="http://saltstack.org">saltstack.org</a>
                                        <a href="http://docs.saltstack.org/en/latest/">Documentation</a>
<!--                                    <a href="#">Blogs</a> -->
                                </div>
                        </div>
                            <div class="row-fluid social">
<!--                                <a href="http://www.facebook.com/SaltStack"><img src="images/socialFB.png" alt="SaltStack on Facebook" /></a> -->
                                    <a href="http://twitter.com/SaltStackInc"><img src="../../_static/images/socialTW.png" alt="SaltStack on Twitter" /></a>
                                    <a href="http://www.linkedin.com/company/salt-stack-inc"><img src="../../_static/images/socialLI.png" alt="SaltStack on LinkedIn" /></a>
<!--                                <a href="http://plus.google.com/114449193225626631691"><img src="images/socialG+.png" alt="SaltStack on Google+" /></a> -->
                                    <a href="https://github.com/saltstack"><img src="../../_static/images/socialGitHub.png" alt="SaltStack on Github" />
                            </div>
                </div>
            </footer>

        <script src="../../_static/js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-26984928-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>

        <script>llactid=23943</script>
        <script src="http://t4.trackalyzer.com/trackalyze.js"></script>
    </body>
</html>